<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>LedgerFlow</title>
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <header class="header">
      <div class="header-inner">
        <div class="brand">
          <img src="/static/logo.svg" alt="LedgerFlow logo" class="brand-logo" />
          <div>
            <div class="brand-title">LedgerFlow</div>
            <div class="brand-subtitle">local-first ledger</div>
          </div>
        </div>
        <div class="status">
          <div class="status-pill" id="health-pill">offline</div>
          <div class="status-meta" id="health-meta"></div>
        </div>
      </div>
    </header>

    <main class="main">
      <section class="card">
        <h2>Manual Entry</h2>
        <form id="manual-form" class="grid">
          <label>
            Date
            <input name="occurredAt" type="date" />
          </label>
          <label>
            Amount (negative = debit)
            <input name="amountValue" type="text" placeholder="-12.30" required />
          </label>
          <label>
            Currency
            <input name="currency" type="text" value="USD" />
          </label>
          <label>
            Merchant
            <input name="merchant" type="text" placeholder="Farmers Market" required />
          </label>
          <label class="full">
            Description
            <input name="description" type="text" placeholder="cash vegetables" />
          </label>
          <label>
            Category hint
            <input name="categoryHint" type="text" placeholder="groceries" />
          </label>
          <label>
            Tags (comma-separated)
            <input name="tags" type="text" placeholder="cash,personal" />
          </label>
          <div class="actions full">
            <button type="submit">Add Transaction</button>
            <div class="muted" id="manual-result"></div>
          </div>
        </form>
      </section>

      <section class="card">
        <h2>Import Bank CSV</h2>
        <form id="csv-form" class="grid">
          <label class="full">
            CSV file
            <input name="file" type="file" accept=".csv,text/csv" required />
          </label>
          <label>
            Mode
            <select name="commit">
              <option value="false" selected>Dry run</option>
              <option value="true">Commit (write to ledger)</option>
            </select>
          </label>
          <label>
            Default currency
            <input name="currency" type="text" value="USD" />
          </label>
          <label>
            Sample (dry-run)
            <input name="sample" type="number" value="5" min="0" />
          </label>
          <label class="full">
            Date format (optional)
            <input name="date_format" type="text" placeholder="%Y-%m-%d" />
          </label>
          <div class="actions full">
            <button type="submit">Run Import</button>
            <div class="muted" id="csv-result"></div>
          </div>
        </form>
      </section>

      <section class="card">
        <h2>Import Receipt / Bill</h2>
        <div class="grid">
          <form id="receipt-form" class="grid full">
            <label class="full">
              Receipt file (txt/pdf/image)
              <input name="file" type="file" accept=".txt,.pdf,.png,.jpg,.jpeg,.webp,image/*,application/pdf,text/plain" required />
            </label>
            <label>
              Default currency
              <input name="currency" type="text" value="USD" />
            </label>
            <label>
              Copy into sources
              <select name="copy_into_sources">
                <option value="false" selected>No</option>
                <option value="true">Yes</option>
              </select>
            </label>
            <div class="actions full">
              <button type="submit">Import Receipt</button>
              <div class="muted" id="receipt-result"></div>
            </div>
          </form>

          <form id="bill-form" class="grid full">
            <label class="full">
              Bill/invoice file (txt/pdf)
              <input name="file" type="file" accept=".txt,.pdf,application/pdf,text/plain" required />
            </label>
            <label>
              Default currency
              <input name="currency" type="text" value="USD" />
            </label>
            <label>
              Copy into sources
              <select name="copy_into_sources">
                <option value="false" selected>No</option>
                <option value="true">Yes</option>
              </select>
            </label>
            <div class="actions full">
              <button type="submit">Import Bill</button>
              <div class="muted" id="bill-result"></div>
            </div>
          </form>
        </div>
      </section>

      <section class="card">
        <h2>Ops</h2>
        <div class="grid">
          <div class="actions full">
            <button id="build-btn" type="button">Build Caches</button>
            <div class="muted" id="build-result"></div>
          </div>

          <form id="alerts-form" class="grid full">
            <label>
              Alerts date
              <input name="at" type="date" />
            </label>
            <label>
              Commit
              <select name="commit">
                <option value="true" selected>Yes</option>
                <option value="false">Dry run</option>
              </select>
            </label>
            <div class="actions full">
              <button type="submit">Run Alerts</button>
              <div class="muted" id="alerts-result"></div>
            </div>
          </form>

          <div class="actions full">
            <button id="link-receipts-btn" type="button">Link Receipts</button>
            <button id="link-bills-btn" type="button">Link Bills</button>
            <div class="muted" id="link-result"></div>
          </div>

          <form id="export-form" class="grid full">
            <label>
              Export from
              <input name="fromDate" type="date" />
            </label>
            <label>
              Export to
              <input name="toDate" type="date" />
            </label>
            <div class="actions full">
              <button type="submit">Export CSV</button>
              <div class="muted" id="export-result"></div>
            </div>
          </form>
        </div>
      </section>

      <section class="card">
        <h2>Reports</h2>
        <div class="grid">
          <form id="daily-report-form" class="grid full">
            <label>
              Daily report date
              <input name="date" type="date" />
            </label>
            <div class="actions full">
              <button type="submit">Generate Daily</button>
              <button id="view-daily-btn" type="button">View Daily</button>
              <div class="muted" id="daily-report-result"></div>
            </div>
          </form>

          <form id="monthly-report-form" class="grid full">
            <label>
              Monthly report (YYYY-MM)
              <input name="month" type="text" placeholder="2026-02" />
            </label>
            <div class="actions full">
              <button type="submit">Generate Monthly</button>
              <button id="view-monthly-btn" type="button">View Monthly</button>
              <div class="muted" id="monthly-report-result"></div>
            </div>
          </form>

          <label class="full">
            Preview
            <textarea id="report-preview" rows="10"></textarea>
          </label>
        </div>
      </section>

      <section class="card">
        <h2>Charts</h2>
        <div class="grid">
          <label>
            Series from
            <input id="charts-from" type="date" />
          </label>
          <label>
            Series to
            <input id="charts-to" type="date" />
          </label>
          <label>
            Month (YYYY-MM)
            <input id="charts-month" type="text" placeholder="2026-02" />
          </label>
          <div class="actions">
            <button id="charts-refresh-btn" type="button">Load Charts</button>
            <div class="muted" id="charts-result"></div>
          </div>
          <label class="full chart-block">
            Spend Series
            <canvas id="series-canvas" width="1000" height="260"></canvas>
          </label>
          <div class="full muted chart-summary" id="series-summary"></div>
          <label class="full chart-block">
            Category Breakdown
            <canvas id="category-canvas" width="1000" height="300"></canvas>
          </label>
          <label class="full chart-block">
            Top Merchants
            <canvas id="merchant-canvas" width="1000" height="300"></canvas>
          </label>
        </div>
      </section>

      <section class="card">
        <h2>AI Insights</h2>
        <div class="grid">
          <label>
            Analysis month (YYYY-MM)
            <input id="ai-month" type="text" placeholder="2026-02" />
          </label>
          <label>
            Narrative provider
            <select id="ai-provider">
              <option value="auto" selected>auto (ollama/openai -> heuristic)</option>
              <option value="heuristic">heuristic only</option>
              <option value="ollama">ollama (local model)</option>
              <option value="openai">openai</option>
            </select>
          </label>
          <label>
            Model override (optional)
            <input id="ai-model" type="text" placeholder="llama3.1:8b or gpt-4.1-mini" />
          </label>
          <label>
            Lookback months
            <input id="ai-lookback" type="number" min="1" max="24" value="6" />
          </label>
          <div class="actions full">
            <button id="ai-run-btn" type="button">Run AI Analysis</button>
            <div class="muted" id="ai-result"></div>
          </div>
          <div class="full ai-summary" id="ai-summary">
            <div class="ai-summary-item">
              <span class="ai-summary-label">Provider used</span>
              <span class="ai-summary-value" id="ai-summary-provider">-</span>
            </div>
            <div class="ai-summary-item">
              <span class="ai-summary-label">Risk flags</span>
              <span class="ai-summary-value" id="ai-summary-risks">0</span>
            </div>
            <div class="ai-summary-item">
              <span class="ai-summary-label">Lookback months</span>
              <span class="ai-summary-value" id="ai-summary-lookback">-</span>
            </div>
            <div class="ai-summary-item">
              <span class="ai-summary-label">Fallback note</span>
              <span class="ai-summary-value" id="ai-summary-fallback">Not run yet.</span>
            </div>
            <div class="ai-summary-item">
              <span class="ai-summary-label">Confidence level</span>
              <span class="ai-summary-value" id="ai-confidence-level">-</span>
            </div>
            <div class="ai-summary-item">
              <span class="ai-summary-label">Confidence score</span>
              <span class="ai-summary-value" id="ai-confidence-score">-</span>
            </div>
            <div class="ai-summary-item full">
              <span class="ai-summary-label">Confidence reasons</span>
              <span class="ai-summary-value" id="ai-confidence-reasons">-</span>
            </div>
          </div>
          <label class="full">
            Narrative
            <textarea id="ai-narrative" rows="4"></textarea>
          </label>
          <label class="full">
            Key Insights
            <textarea id="ai-insights" rows="6"></textarea>
          </label>
          <label class="full">
            Recommendations
            <textarea id="ai-recommendations" rows="6"></textarea>
          </label>
          <label class="full">
            Explainability Evidence
            <textarea id="ai-evidence" rows="6"></textarea>
          </label>
          <label class="full chart-block">
            Spend Trend + Forecast
            <canvas id="ai-forecast-canvas" width="1000" height="280"></canvas>
          </label>
        </div>
      </section>

      <section class="card">
        <h2>Automation</h2>
        <div class="grid">
          <label>
            Queue limit
            <input id="automation-limit" type="number" value="12" min="1" max="200" />
          </label>
          <label>
            Status filter (optional)
            <input id="automation-status" type="text" placeholder="queued,running,done,failed" />
          </label>
          <div class="actions full automation-actions">
            <button id="automation-enqueue-build-btn" type="button">Enqueue Build Task</button>
            <button id="automation-run-due-btn" type="button">Run Due Jobs</button>
            <button id="automation-run-next-btn" type="button">Run Next Task</button>
            <button id="automation-refresh-btn" type="button">Refresh Queue</button>
            <div class="muted" id="automation-result"></div>
          </div>
        </div>
        <div class="table-wrap">
          <table class="table" id="automation-table">
            <thead>
              <tr>
                <th>Task ID</th>
                <th>Type</th>
                <th>Status</th>
                <th>Attempts</th>
                <th>Available At</th>
                <th>Updated</th>
                <th>Source</th>
                <th class="wrap">Result / Error</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <section class="card">
        <h2>Review Queue</h2>
        <div class="grid">
          <label>
            Filter date (optional)
            <input id="review-date" type="date" />
          </label>
          <div class="actions">
            <button id="review-refresh-btn" type="button">Refresh Queue</button>
            <div class="muted" id="review-result"></div>
          </div>
        </div>
        <div class="table-wrap">
          <table class="table" id="review-table">
            <thead>
              <tr>
                <th>Kind</th>
                <th>Date</th>
                <th>ID</th>
                <th>Merchant/Source</th>
                <th>Reasons</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <section class="card">
        <h2>Recent Transactions</h2>
        <div class="toolbar">
          <button id="refresh-btn" type="button">Refresh</button>
          <label class="inline">
            Limit
            <input id="tx-limit" type="number" value="50" min="1" max="500" />
          </label>
        </div>
        <div class="table-wrap">
          <table class="table" id="tx-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Amount</th>
                <th>Currency</th>
                <th>Merchant</th>
                <th>Description</th>
                <th>Category</th>
                <th>Source</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>
    </main>

    <script src="/static/app.js"></script>
  </body>
</html>
